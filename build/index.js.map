{"version":3,"sources":["db/schemas/tracks.js","db/models/tracks.js","src/handleData/index.js","index.js"],"names":["Tracks","Schema","userId","Number","trackingNumber","String","trackInfo","Track","mongose","model","trackSchema","getTrackInfo","trackNumber","data","Axios","get","$","cheerio","load","dataRows","events","each","date","children","text","event","push","addOrUpdateData","updateOne","JSON","stringify","upsert","setDefaultsOnInsert","console","log"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA,MAAMA,MAAM,GAAG,IAAIC,gBAAJ,CAAW;AACtBC,EAAAA,MAAM,EAAEC,MADc;AAEtBC,EAAAA,cAAc,EAAEC,MAFM;AAGtBC,EAAAA,SAAS,EAAED;AAHW,CAAX,CAAf;eAMeL;;;;;;;;;;ACRf;;AACA;;;;AAEA,MAAMO,KAAK,GAAGC,kBAAQC,KAAR,CAAc,OAAd,EAAuBC,eAAvB,CAAd;;eAEeH;;;;;;;;;;ACLf;;AACA;;AACA;;;;;;;;AAEO,MAAMI,YAAY,GAAG,MAAMC,WAAN,IAAqB;AAC/C,QAAM;AAAEC,IAAAA;AAAF,MAAW,MAAMC,eAAMC,GAAN,CACpB,kCAAiCH,WAAY,EADzB,CAAvB;AAGA,QAAMI,CAAC,GAAGC,OAAO,CAACC,IAAR,CAAaL,IAAb,CAAV;AACA,QAAMM,QAAQ,GAAGH,CAAC,CAAC,MAAD,CAAlB;AACA,QAAMI,MAAM,GAAG,EAAf;AAEAD,EAAAA,QAAQ,CAACE,IAAT,CAAc,YAAW;AACvB,UAAMC,IAAI,GAAGN,CAAC,CAAC,IAAD,CAAD,CACVO,QADU,CACD,8BADC,EAEVC,IAFU,EAAb;AAGA,UAAMC,KAAK,GAAGT,CAAC,CAAC,IAAD,CAAD,CACXO,QADW,CACF,+BADE,EAEXC,IAFW,EAAd;AAIAJ,IAAAA,MAAM,CAACM,IAAP,CAAY;AAAEJ,MAAAA,IAAF;AAAQG,MAAAA;AAAR,KAAZ;AACD,GATD;AAWA,SAAOL,MAAP;AACD,CApBM;;;;AAsBA,MAAMO,eAAe,GAAG,OAAO;AAAEd,EAAAA,IAAF;AAAQX,EAAAA,MAAR;AAAgBE,EAAAA;AAAhB,CAAP,KAA4C;AACzE,QAAMG,gBAAMqB,SAAN,CAAgB;AAAE1B,IAAAA,MAAF;AAAUE,IAAAA;AAAV,GAAhB,EAA4C;AAAEA,IAAAA,cAAF;AAAkBF,IAAAA,MAAlB;AAA0BI,IAAAA,SAAS,EAAEuB,IAAI,CAACC,SAAL,CAAejB,IAAf;AAArC,GAA5C,EAAyG;AAAEkB,IAAAA,MAAM,EAAE,IAAV;AAAgBC,IAAAA,mBAAmB,EAAE;AAArC,GAAzG,CAAN;AACD,CAFM;;;;;;ACzBP;;AAGA,CAAC,YAAY;AACT;AAEAC,EAAAA,OAAO,CAACC,GAAR,CAAYrB,IAAZ,EAHS,CAIT;AACA;;AACAoB,EAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AAEH,CARD","file":"index.js","sourceRoot":"..","sourcesContent":["import { Schema } from 'mongoose';\n\nconst Tracks = new Schema({\n    userId: Number,\n    trackingNumber: String,\n    trackInfo: String,\n})\n\nexport default Tracks;","import trackSchema from '../schemas/tracks'\nimport mongose from 'mongoose';\n\nconst Track = mongose.model('Track', trackSchema);\n\nexport default Track;","import * as cheerio from \"cheerio\"\nimport Axios from \"axios\"\nimport Track from '../../db/models/tracks';\n\nexport const getTrackInfo = async trackNumber => {\n  const { data } = await Axios.get(\n    `http://posta.md/ro/tracking?id=${trackNumber}`\n  )\n  const $ = cheerio.load(data)\n  const dataRows = $(\".row\")\n  const events = []\n\n  dataRows.each(function() {\n    const date = $(this)\n      .children(\".tracking-result-header-date\")\n      .text()\n    const event = $(this)\n      .children(\".tracking-result-header-event\")\n      .text()\n\n    events.push({ date, event })\n  })\n\n  return events\n}\n\nexport const addOrUpdateData = async ({ data, userId, trackingNumber }) => {\n  await Track.updateOne({ userId, trackingNumber }, { trackingNumber, userId, trackInfo: JSON.stringify(data) }, { upsert: true, setDefaultsOnInsert: true})\n}\n\n","\nimport { getTrackInfo, addOrUpdateData, lastEntries } from './src/handleData';\n\n\n(async () => {\n    // const data = await getTrackInfo('RG910688822BE')\n   \n    console.log(data);\n    // addOrUpdateData({ userId: 1, trackingNumber: 'RG910688822BE', data })\n    // lastEntries();\n    console.log('da')\n\n})()"]}